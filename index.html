<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ley Dinámica desde Google Sheets</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f8f9fa;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; background: var(--bg); }

        /* Sidebar Dinámico */
        nav#sidebar {
            width: 280px;
            height: 100vh;
            background: var(--primary);
            color: white;
            position: sticky;
            top: 0;
            padding: 20px;
            overflow-y: auto;
        }

        nav#sidebar a {
            color: #bdc3c7;
            text-decoration: none;
            display: block;
            padding: 8px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid #3e4f5f;
        }

        nav#sidebar a:hover { color: white; }

        /* Contenedor de la Ley */
        main#content {
            flex: 1;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        .capitulo-header {
            background: #eee;
            padding: 10px 20px;
            margin: 40px 0 20px 0;
            border-radius: 5px;
            color: var(--primary);
        }

        article {
            margin-bottom: 30px;
            scroll-margin-top: 20px; /* Para que al clickar el índice no tape el título */
        }

        .summary-box {
            background: #eef7fd;
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin: 10px 0;
            font-size: 0.95rem;
            color: #444;
        }

        .loading { text-align: center; margin-top: 50px; font-style: italic; }
    </style>
</head>
<body>

    <nav id="sidebar">
        <h2>Índice</h2>
        <div id="indice-lista">Cargando...</div>
    </nav>

    <main id="content">
        <header>
            <h1>Cuerpo Legal</h1>
            <p id="fecha-actualizacion"></p>
        </header>
        <div id="ley-container">
            <p class="loading">Obteniendo datos de la ley...</p>
        </div>
    </main>

    <script>
        // URL de tu Google Sheets en formato CSV
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbTeVPW_y3RyVjkLyxailFMH0WNRy0v16-pFQF6vHZ8LDnhlSJvSbQ7lQDfCgZnyHMQJVHlnYMIH4F/pub?output=csv';

        async function cargarLey() {
            try {
                const respuesta = await fetch(csvUrl);
                const datosTexto = await respuesta.text();
                
                // Convertir CSV a Array de Objetos
                const filas = datosTexto.split('\n').slice(1); // Quitamos la cabecera
                const leyContainer = document.getElementById('ley-container');
                const indiceLista = document.getElementById('indice-lista');
                
                leyContainer.innerHTML = '';
                indiceLista.innerHTML = '';

                let ultimoCapitulo = "";

                filas.forEach((fila, index) => {
                    // Limpieza básica de datos (manejo de comillas en CSV)
                    const columnas = fila.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (columnas.length < 5) return;

                    const [capitulo, articulo, titulo, resumen, contenido] = columnas.map(c => c.replace(/"/g, '').trim());

                    // Crear encabezado de capítulo si cambia
                    if (capitulo !== ultimoCapitulo) {
                        const capId = `cap-${index}`;
                        leyContainer.innerHTML += `<h2 class="capitulo-header" id="${capId}">${capitulo}</h2>`;
                        indiceLista.innerHTML += `<strong style="display:block; margin-top:15px; color:#fff">${capitulo}</strong>`;
                        ultimoCapitulo = capitulo;
                    }

                    // Crear el artículo
                    const artId = `art-${articulo.replace(/\s+/g, '')}`;
                    
                    // Agregar al contenido principal
                    leyContainer.innerHTML += `
                        <article id="${artId}">
                            <h3>Artículo ${articulo}. ${titulo}</h3>
                            <div class="summary-box"><strong>En resumen:</strong> ${resumen}</div>
                            <p>${contenido}</p>
                        </article>
                    `;

                    // Agregar al índice lateral
                    indiceLista.innerHTML += `<a href="#${artId}">Art. ${articulo}</a>`;
                });

                document.getElementById('fecha-actualizacion').innerText = "Sincronizado con Google Sheets";

            } catch (error) {
                console.error("Error cargando la ley:", error);
                document.getElementById('ley-container').innerHTML = "Error al cargar los datos. Verifica que el CSV sea público.";
            }
        }

        cargarLey();
    </script>
</body>
</html>
